# -*- encoding: utf-8 -*-
import dsl
from shapely.wkt import loads as wkt_loads

from . import FixtureTest


class NormalizePlaceKind(FixtureTest):
    def test_state(self):
        # Node: California (671022)
        self.generate_fixtures(dsl.way(671022, wkt_loads('POINT (-118.755997317217 36.70146306433398)'), {u'name:short': u'CA', u'name:cs': u'Kalifornie', u'name:tt': u'\u041a\u0430\u043b\u0438\u0444\u043e\u0440\u043d\u0438\u044f', u'name:iu': u'\u1473\u14d6\u1434\u1550\u14c3\u140a / kaaliipuurniia', u'name:it': u'California', u'name:ru': u'\u041a\u0430\u043b\u0438\u0444\u043e\u0440\u043d\u0438\u044f', u'name:vi': u'Ca Li', u'name:pl': u'Kalifornia', u'name:abbreviation': u'Calif.', u'is_in': u'USA', u'state_code': u'CA', u'alt_name:vi': u'California', u'name:da': u'Californien', u'wikipedia': u'en:California', u'name:de': u'Kalifornien', u'name:tzl': u'Californica', u'name:fr': u'Californie', u'name:fy': u'Kalifornje', u'name:af': u'Kaliforni\xeb', u'ref': u'CA', u'name:nl': u'Californi\xeb', u'name:ja': u'\u30ab\u30ea\u30d5\u30a9\u30eb\u30cb\u30a2', u'name:lt': u'Kalifornija', u'name:sv': u'Karlifonien', u'name:he': u'\u05e7\u05dc\u05d9\u05e4\u05d5\u05e8\u05e0\u05d9\u05d4', u'is_in:country_code': u'US', u'source:population': u'Census 2010, from Wikipedia', u'name:lb': u'Kalifornien', u'name:sk': u'Kalifornia', u'name:tok': u'ma Kaliponija', u'name:uk': u'\u041a\u0430\u043b\u0456\u0444\u043e\u0440\u043d\u0456\u044f', u'name:be': u'\u041a\u0430\u043b\u0456\u0444\u043e\u0440\u043d\u0456\u044f', u'name:hu': u'Kalifornia', u'name:ba': u'\u041a\u0430\u043b\u0438\u0444\u043e\u0440\u043d\u0438\u044f', u'population': u'37253956', u'name:el': u'\u039a\u03b1\u03bb\u03b9\u03c6\u03cc\u03c1\u03bd\u03b9\u03b1', u'name:eo': u'Kalifornio', u'name:en': u'California', u'name': u'California', u'name:zh': u'\u52a0\u5229\u798f\u5c3c\u4e9a\u5dde', u'is_in:country': u'USA', u'place': u'state', u'source': u'openstreetmap.org', u'is_in:continent': u'North America', u'name:es': u'California'}))

        self.assert_has_feature(
            16, 11149, 25576, 'places',
            {'id': 671022, 'kind': 'region', 'kind_detail': 'state'})

    def test_province(self):
        # Node: Saga Prefecture (1499608655)
        self.generate_fixtures(dsl.way(1499608655, wkt_loads('POINT (130.129658488119 33.2185407589383)'), {u'name:en': u'Saga Prefecture', u'name': u'\u4f50\u8cc0\u770c (Saga Prefecture)', u'name:ja_rm': u'Saga-ken', u'source': u'openstreetmap.org', u'int_name': u'Saga', u'place': u'province', u'name:uk': u'\u0421\u0430\u0491\u0430', u'name:ru': u'\u0421\u0430\u0433\u0430', u'name:pl': u'Saga', u'name:hu': u'Saga prefekt\xfara', u'name:ja': u'\u4f50\u8cc0\u770c'}))

        self.assert_has_feature(
            16, 56457, 26350, 'places',
            {'id': 1499608655, 'kind': 'region', 'kind_detail': 'province'})

    def test_city(self):
        # Node: San Francisco (26819236)
        self.generate_fixtures(dsl.way(26819236, wkt_loads('POINT (-122.419236226182 37.77928077351228)'), {u'name:pt': u'S\xe3o Francisco', u'name:ko': u'\uc0cc\ud504\ub780\uc2dc\uc2a4\ucf54', u'name:kn': u'\u0cb8\u0cbe\u0ca8\u0ccd \u0cab\u0ccd\u0cb0\u0cbe\u0ca8\u0ccd\u0cb8\u0cbf\u0cb8\u0ccd\u0c95\u0cca', u'rank': u'10', u'wikidata': u'Q62', u'name:ru': u'\u0421\u0430\u043d-\u0424\u0440\u0430\u043d\u0446\u0438\u0441\u043a\u043e', u'name:ta': u'\u0bb8\u0bbe\u0ba9\u0bcd \u0baa\u0bcd\xb2\u0bb0\u0bbe\u0ba9\u0bcd\u0bb8\u0bbf\u0bb8\u0bcd\u0b95\u0bca', u'name:fa': u'\u0633\u0627\u0646 \u0641\u0631\u0627\u0646\u0633\u06cc\u0633\u06a9\u0648', u'is_in:country': u'United States', u'wikipedia': u'en:San Francisco', u'name:de': u'San Francisco', u'source': u'openstreetmap.org', u'name:zh': u'\u65e7\u91d1\u5c71', u'name:ja': u'\u30b5\u30f3\u30d5\u30e9\u30f3\u30b7\u30b9\u30b3', u'short_name': u'SF', u'name:hi': u'\u0938\u0948\u0928 \u092b\u094d\u0930\u093e\u0902\u0938\u093f\u0938\u094d\u0915\u094b', u'is_in:country_code': u'US', u'census:population': u'2010', u'population': u'864816', u'fixme': u'When zooming out, Oakland (a nearby city) label covers over the San Francisco label', u'name': u'San Francisco', u'place': u'city', u'is_in:continent': u'North America', u'name:eu': u'San Francisco'}))

        self.assert_has_feature(
            16, 10482, 25330, 'places',
            {'id': 26819236, 'kind': 'locality', 'kind_detail': 'city'})

    def test_town(self):
        # Node: Daly City (140983265)
        self.generate_fixtures(dsl.way(140983265, wkt_loads('POINT (-122.461920395559 37.70576709061871)'), {u'gnis:ST_alpha': u'CA', u'gnis:County_num': u'081', u'name': u'Daly City', u'is_in:country': u'USA', u'gnis:ST_num': u'06', u'census:population': u'101005;2006', u'ele': u'124', u'import_uuid': u'bb7269ee-502a-5391-8056-e3ce0e66489c', u'gnis:Class': u'Populated Place', u'place': u'town', u'source': u'openstreetmap.org', u'is_in:continent': u'North America', u'population': u'101005', u'gnis:County': u'San Mateo', u'gnis:id': u'1658369', u'name:zh': u'\u6234\u5229\u57ce', u'is_in': u'San Mateo,California,Calif.,CA,USA'}))

        self.assert_has_feature(
            16, 10474, 25346, 'places',
            {'id': 140983265, 'kind': 'locality', 'kind_detail': 'town'})

    def test_village(self):
        # Node: Broadmoor (140983130)
        self.generate_fixtures(dsl.way(140983130, wkt_loads('POINT (-122.481083975852 37.68993320391891)'), {u'gnis:ST_alpha': u'CA', u'gnis:County_num': u'081', u'name': u'Broadmoor', u'source': u'openstreetmap.org', u'gnis:ST_num': u'06', u'ele': u'53', u'import_uuid': u'bb7269ee-502a-5391-8056-e3ce0e66489c', u'gnis:Class': u'Populated Place', u'place': u'village', u'gnis:County': u'San Mateo', u'gnis:id': u'1785679', u'is_in': u'San Mateo,California,Calif.,CA,USA'}))

        self.assert_has_feature(
            16, 10470, 25350, 'places',
            {'id': 140983130, 'kind': 'locality', 'kind_detail': 'village'})

    def test_hamlet(self):
        # Node: Baden (150937258)
        self.generate_fixtures(dsl.way(150937258, wkt_loads('POINT (-122.434139276745 37.64965648018499)'), {u'gnis:ST_alpha': u'CA', u'gnis:County_num': u'081', u'name': u'Baden', u'source': u'openstreetmap.org', u'gnis:ST_num': u'06', u'ele': u'28', u'import_uuid': u'bb7269ee-502a-5391-8056-e3ce0e66489c', u'gnis:Class': u'Populated Place', u'place': u'hamlet', u'gnis:County': u'San Mateo', u'gnis:id': u'256018', u'is_in': u'San Mateo,California,Calif.,CA,USA'}))

        self.assert_has_feature(
            16, 10479, 25359, 'places',
            {'id': 150937258, 'kind': 'locality', 'kind_detail': 'hamlet'})

    def test_locality(self):
        # Node: McCovey Cove (317091394)
        self.generate_fixtures(dsl.way(317091394, wkt_loads('POINT (-122.388472880288 37.77762295869271)'), {u'source': u'openstreetmap.org', u'place': u'locality', u'name': u'McCovey Cove'}))

        self.assert_has_feature(
            16, 10487, 25330, 'places',
            {'id': 317091394, 'kind': 'locality', 'kind_detail': 'locality'})

    def test_isolated_dwelling(self):
        # Node: Gilman Ranch (2682626694)
        self.generate_fixtures(dsl.way(2682626694, wkt_loads('POINT (-121.814865333712 37.13662730079439)'), {u'source': u'openstreetmap.org', u'place': u'isolated_dwelling', u'name': u'Gilman Ranch'}))

        self.assert_has_feature(
            16, 10592, 25477, 'places',
            {'id': 2682626694, 'kind': 'locality',
             'kind_detail': 'isolated_dwelling'})

    def test_farm(self):
        # Node: Stevens Canyon Ranch (3219761323)
        self.generate_fixtures(dsl.way(3219761323, wkt_loads('POINT (-122.102216001345 37.27015237705979)'), {u'source': u'openstreetmap.org', u'place': u'farm', u'name': u'Stevens Canyon Ranch'}))

        self.assert_has_feature(
            16, 10539, 25446, 'places',
            {'id': 3219761323, 'kind': 'locality', 'kind_detail': 'farm'})


class NormalizePlaceKindNaturalEarth(FixtureTest):

    def setUp(self):
        super(NormalizePlaceKindNaturalEarth, self).setUp()
        self.generate_fixtures(dsl.way(1, wkt_loads('POINT (-62.08996749026979 -31.43003375369007)'), {u'labelrank': 3, u'max_bbymin': -31.45, u'max_bbymax': -31.40833333, u'namediff': 0, u'max_areami': 7.0, u'pop1960': 0.0, u'pop1965': 0.0, u'min_perkm': 21.0, u'max_pop50': 0, u'source': u'naturalearthdata.com', u'latitude': -31.4300337537, u'elevation': 0.0, u'diffnote': u'', u'min_areakm': 19, u'namealt': u'', u'rank_min': 7, u'sov0name': u'Argentina', u'cityalt': u'', u'name': u'San Francisco', u'pop1995': 0.0, u'max_natsca': 10, u'pop1990': 0.0, u'max_pop20': 0, u'min_bbxmin': -62.10833333, u'adm0cap': 0.0, u'max_areakm': 19.0, u'natscale': 10, u'pop2010': 0.0, u'pop2015': 0.0, u'pop1985': 0.0, u'pop1980': 0.0, u'sov_a3': u'ARG', u'un_adm0': u'', u'ls_match': 1, u'namepar': u'', u'min_areami': 7.0, u'adm0name': u'Argentina', u'un_lat': 0.0, u'min_permi': 13.0, u'pop2000': 0.0, u'pop2005': 0.0, u'changed': 0.0, u'nameascii': u'San Francisco', u'geonamesno': u'Geonames ascii name + lat.d + long.d matching.', u'meganame': u'', u'scalerank': 8, u'ls_name': u'San Francisco2', u'gtopo30': 123.0, u'mean_bbyc': -31.42948718, u'iso_a2': u'AR', u'max_permi': 13.0, u'feature_co': u'PPL', u'feature_cl': u'P', u'rank_max': 8, u'geonameid': 3837675.0, u'diffascii': 0, u'max_pop10': 27400, u'min_bbymin': -31.45, u'pop_max': 59062, u'min_bbymax': -31.40833333, u'capalt': 0.0, u'mean_bbxc': -62.08269231, u'checkme': 2, u'megacity': 0, u'capin': u'', u'pop_min': 27400, u'pop2020': 0.0, u'longitude': -62.0899674903, u'pop2025': 0.0, u'min_bbxmax': -62.05, u'adm1name': u'CRrdoba', u'pop1950': 0.0, u'pop1955': 0.0, u'max_pop310': 0, u'compare': 0, u'max_perkm': 21.0, u'admin1_cod': 5.0, u'adm0_a3': u'ARG', u'timezone': u'America/Argentina/Cordoba', u'note': u'', u'pop2050': 0.0, u'worldcity': 0.0, u'un_long': 0.0, u'max_pop300': 0, u'max_bbxmin': -62.10833333, u'featurecla': u'Populated place', u'pop1975': 0.0, u'gn_ascii': u'San Francisco', u'pop1970': 0.0, u'max_bbxmax': -62.05, u'un_fid': 0, u'pop_other': 27400, u'gn_pop': 59062}),dsl.way(2, wkt_loads('POINT (-64.04687560264087 -64.7624133527419)'), {u'labelrank': 0, u'max_bbymin': 0.0, u'max_bbymax': 0.0, u'namediff': 0, u'max_areami': 0.0, u'pop1960': 0.0, u'pop1965': 0.0, u'min_perkm': 0.0, u'max_pop50': 0, u'source': u'naturalearthdata.com', u'latitude': -64.7624133527, u'elevation': 0.0, u'diffnote': u'Changed feature class.', u'min_areakm': 0, u'namealt': u'', u'rank_min': 1, u'sov0name': u'Indeterminate', u'cityalt': u'', u'name': u'Palmer Station', u'pop1995': 0.0, u'max_natsca': 0, u'pop1990': 0.0, u'max_pop20': 0, u'min_bbxmin': 0.0, u'adm0cap': 0.0, u'max_areakm': 0.0, u'natscale': 20, u'pop2010': 0.0, u'pop2015': 0.0, u'pop1985': 0.0, u'pop1980': 0.0, u'sov_a3': u'ATA', u'un_adm0': u'', u'ls_match': 0, u'namepar': u'USA', u'min_areami': 0.0, u'adm0name': u'Antarctica', u'un_lat': 0.0, u'min_permi': 0.0, u'pop2000': 0.0, u'pop2005': 0.0, u'changed': 4.0, u'nameascii': u'Palmer Station', u'geonamesno': u'No GeoNames match due to small population, not in GeoNames, or poor NEV placement.', u'meganame': u'', u'scalerank': 7, u'ls_name': u'Palmer Station (USA)', u'gtopo30': 0.0, u'mean_bbyc': 0.0, u'iso_a2': u'AQ', u'max_permi': 0.0, u'feature_co': u'', u'feature_cl': u'', u'rank_max': 1, u'geonameid': -1.0, u'diffascii': 0, u'max_pop10': 0, u'min_bbymin': 0.0, u'pop_max': 46, u'min_bbymax': 0.0, u'capalt': 0.0, u'mean_bbxc': 0.0, u'checkme': 3, u'megacity': 0, u'capin': u'', u'pop_min': 15, u'pop2020': 0.0, u'longitude': -64.0468756026, u'pop2025': 0.0, u'min_bbxmax': 0.0, u'adm1name': u'', u'pop1950': 0.0, u'pop1955': 0.0, u'max_pop310': 0, u'compare': 0, u'max_perkm': 0.0, u'admin1_cod': 0.0, u'adm0_a3': u'ATA', u'timezone': u'', u'note': u'', u'pop2050': 0.0, u'worldcity': 0.0, u'un_long': 0.0, u'max_pop300': 0, u'max_bbxmin': 0.0, u'featurecla': u'Scientific station', u'pop1975': 0.0, u'gn_ascii': u'', u'pop1970': 0.0, u'max_bbxmax': 0.0, u'un_fid': 0, u'pop_other': 0, u'gn_pop': 0}),dsl.way(3, wkt_loads('POINT (-57.99998458009719 -61.99958901097382)'), {u'labelrank': 0, u'max_bbymin': 0.0, u'max_bbymax': 0.0, u'namediff': 0, u'max_areami': 0.0, u'pop1960': 0.0, u'pop1965': 0.0, u'min_perkm': 0.0, u'max_pop50': 0, u'source': u'naturalearthdata.com', u'latitude': -61.999589011, u'elevation': 0.0, u'diffnote': u'Changed feature class.', u'min_areakm': 0, u'namealt': u'', u'rank_min': 0, u'sov0name': u'Indeterminate', u'cityalt': u'', u'name': u'Elephant Island', u'pop1995': 0.0, u'max_natsca': 0, u'pop1990': 0.0, u'max_pop20': 0, u'min_bbxmin': 0.0, u'adm0cap': 0.0, u'max_areakm': 0.0, u'natscale': 20, u'pop2010': 0.0, u'pop2015': 0.0, u'pop1985': 0.0, u'pop1980': 0.0, u'sov_a3': u'ATA', u'un_adm0': u'', u'ls_match': 0, u'namepar': u'', u'min_areami': 0.0, u'adm0name': u'Antarctica', u'un_lat': 0.0, u'min_permi': 0.0, u'pop2000': 0.0, u'pop2005': 0.0, u'changed': 4.0, u'nameascii': u'Elephant Island, South Shetland Islands', u'geonamesno': u'No GeoNames match due to small population, not in GeoNames, or poor NEV placement.', u'meganame': u'', u'scalerank': 7, u'ls_name': u'Elephant Island, South Shetland Islands', u'gtopo30': 0.0, u'mean_bbyc': 0.0, u'iso_a2': u'AQ', u'max_permi': 0.0, u'feature_co': u'', u'feature_cl': u'', u'rank_max': 1, u'geonameid': -1.0, u'diffascii': 0, u'max_pop10': 0, u'min_bbymin': 0.0, u'pop_max': 6, u'min_bbymax': 0.0, u'capalt': 0.0, u'mean_bbxc': 0.0, u'checkme': 3, u'megacity': 0, u'capin': u'', u'pop_min': 0, u'pop2020': 0.0, u'longitude': -57.9999845801, u'pop2025': 0.0, u'min_bbxmax': 0.0, u'adm1name': u'', u'pop1950': 0.0, u'pop1955': 0.0, u'max_pop310': 0, u'compare': 0, u'max_perkm': 0.0, u'admin1_cod': 0.0, u'adm0_a3': u'ATA', u'timezone': u'', u'note': u'Summer only', u'pop2050': 0.0, u'worldcity': 0.0, u'un_long': 0.0, u'max_pop300': 0, u'max_bbxmin': 0.0, u'featurecla': u'Scientific station', u'pop1975': 0.0, u'gn_ascii': u'', u'pop1970': 0.0, u'max_bbxmax': 0.0, u'un_fid': 0, u'pop_other': 0, u'gn_pop': 0}),dsl.way(4, wkt_loads('POINT (30.09887569043752 51.38940716461001)'), {u'labelrank': 5, u'max_bbymin': 0.0, u'max_bbymax': 0.0, u'namediff': 0, u'max_areami': 0.0, u'pop1960': 0.0, u'pop1965': 0.0, u'min_perkm': 0.0, u'max_pop50': 0, u'source': u'naturalearthdata.com', u'latitude': 51.3894071646, u'elevation': 0.0, u'diffnote': u'Changed scale rank.', u'min_areakm': 0, u'namealt': u'Chornobyl', u'rank_min': 0, u'sov0name': u'Ukraine', u'cityalt': u'', u'name': u'Chernobyl', u'pop1995': 0.0, u'max_natsca': 0, u'pop1990': 0.0, u'max_pop20': 0, u'min_bbxmin': 0.0, u'adm0cap': 0.0, u'max_areakm': 0.0, u'natscale': 30, u'pop2010': 0.0, u'pop2015': 0.0, u'pop1985': 0.0, u'pop1980': 0.0, u'sov_a3': u'UKR', u'un_adm0': u'', u'ls_match': 0, u'namepar': u'', u'min_areami': 0.0, u'adm0name': u'Ukraine', u'un_lat': 0.0, u'min_permi': 0.0, u'pop2000': 0.0, u'pop2005': 0.0, u'changed': 1.0, u'nameascii': u'Chernobyl', u'geonamesno': u'No GeoNames match due to small population, not in GeoNames, or poor NEV placement.', u'meganame': u'', u'scalerank': 6, u'ls_name': u'Chernobyl (Chornobyl)', u'gtopo30': 0.0, u'mean_bbyc': 0.0, u'iso_a2': u'UA', u'max_permi': 0.0, u'feature_co': u'', u'feature_cl': u'', u'rank_max': 0, u'geonameid': -1.0, u'diffascii': 0, u'max_pop10': 0, u'min_bbymin': 0.0, u'pop_max': 0, u'min_bbymax': 0.0, u'capalt': 0.0, u'mean_bbxc': 0.0, u'checkme': 0, u'megacity': 0, u'capin': u'', u'pop_min': 0, u'pop2020': 0.0, u'longitude': 30.0988756904, u'pop2025': 0.0, u'min_bbxmax': 0.0, u'adm1name': u'Kiev', u'pop1950': 0.0, u'pop1955': 0.0, u'max_pop310': 0, u'compare': 0, u'max_perkm': 0.0, u'admin1_cod': 0.0, u'adm0_a3': u'UKR', u'timezone': u'', u'note': u'', u'pop2050': 0.0, u'worldcity': 0.0, u'un_long': 0.0, u'max_pop300': 0, u'max_bbxmin': 0.0, u'featurecla': u'Historic place', u'pop1975': 0.0, u'gn_ascii': u'', u'pop1970': 0.0, u'max_bbxmax': 0.0, u'un_fid': 0, u'pop_other': 0, u'gn_pop': 0}),dsl.way(5, wkt_loads('POINT (135.7480520653204 35.03193814685564)'), {u'labelrank': 2, u'max_bbymin': 34.78333333, u'max_bbymax': 35.1, u'namediff': 0, u'max_areami': 188.0, u'pop1960': 1165.0, u'pop1965': 1229.0, u'min_perkm': 130.0, u'max_pop50': 2520813, u'source': u'naturalearthdata.com', u'latitude': 35.0299922882, u'elevation': 0.0, u'diffnote': u'', u'min_areakm': 340, u'namealt': u'', u'rank_min': 12, u'sov0name': u'Japan', u'cityalt': u'', u'name': u'Kyoto', u'pop1995': 1804.0, u'max_natsca': 50, u'pop1990': 1760.0, u'max_pop20': 2520813, u'min_bbxmin': 135.61152884, u'adm0cap': 0.0, u'max_areakm': 486.0, u'natscale': 50, u'pop2010': 1805.0, u'pop2015': 1804.0, u'pop1985': 1714.0, u'pop1980': 1701.0, u'sov_a3': u'JPN', u'un_adm0': u'Japan', u'ls_match': 1, u'namepar': u'', u'min_areami': 131.0, u'adm0name': u'Japan', u'un_lat': 35.0, u'min_permi': 81.0, u'pop2000': 1806.0, u'pop2005': 1805.0, u'changed': 0.0, u'nameascii': u'Kyoto', u'geonamesno': u'GeoNames match general.', u'meganame': u'Kyoto', u'scalerank': 4, u'ls_name': u'Kyoto', u'gtopo30': 86.0, u'mean_bbyc': 34.9131706467, u'iso_a2': u'JP', u'max_permi': 135.0, u'feature_co': u'PPLA', u'feature_cl': u'P', u'rank_max': 12, u'geonameid': 1857910.0, u'diffascii': 0, u'max_pop10': 1946052, u'min_bbymin': 34.6450605, u'pop_max': 1805000, u'min_bbymax': 35.1, u'capalt': 1.0, u'mean_bbxc': 135.74321246, u'checkme': 0, u'megacity': 1, u'capin': u'Official capita', u'pop_min': 1459640, u'pop2020': 1804.0, u'longitude': 135.749997924, u'pop2025': 1804.0, u'min_bbxmax': 135.80833333, u'adm1name': u'Kyoto', u'pop1950': 1002.0, u'pop1955': 1091.0, u'max_pop310': 0, u'compare': 0, u'max_perkm': 218.0, u'admin1_cod': 22.0, u'adm0_a3': u'JPN', u'timezone': u'Asia/Tokyo', u'note': u'', u'pop2050': 1804.0, u'worldcity': 0.0, u'un_long': 135.75, u'max_pop300': 0, u'max_bbxmin': 135.61152884, u'featurecla': u'Admin-0 capital alt', u'pop1975': 1622.0, u'gn_ascii': u'Kyoto', u'pop1970': 1298.0, u'max_bbxmax': 135.85833333, u'un_fid': 313, u'pop_other': 1827367, u'gn_pop': 1459640}),dsl.way(6, wkt_loads('POINT (-60.17998071454596 46.06611452135952)'), {u'labelrank': 2, u'max_bbymin': 46.09166667, u'max_bbymax': 46.18333333, u'namediff': 0, u'max_areami': 15.0, u'pop1960': 0.0, u'pop1965': 0.0, u'min_perkm': 55.0, u'max_pop50': 0, u'source': u'naturalearthdata.com', u'latitude': 46.0661145214, u'elevation': 0.0, u'diffnote': u'', u'min_areakm': 39, u'namealt': u'', u'rank_min': 7, u'sov0name': u'Canada', u'cityalt': u'', u'name': u'Sydney', u'pop1995': 0.0, u'max_natsca': 20, u'pop1990': 0.0, u'max_pop20': 37538, u'min_bbxmin': -60.25, u'adm0cap': 0.0, u'max_areakm': 39.0, u'natscale': 50, u'pop2010': 0.0, u'pop2015': 0.0, u'pop1985': 0.0, u'pop1980': 0.0, u'sov_a3': u'CAN', u'un_adm0': u'', u'ls_match': 1, u'namepar': u'', u'min_areami': 15.0, u'adm0name': u'Canada', u'un_lat': 0.0, u'min_permi': 34.0, u'pop2000': 0.0, u'pop2005': 0.0, u'changed': 0.0, u'nameascii': u'Sydney', u'geonamesno': u'Top 50 ranks with no GeoNames match due to small population, not in GeoNames, or poor NEV placement.', u'meganame': u'', u'scalerank': 4, u'ls_name': u'Sydney2', u'gtopo30': 0.0, u'mean_bbyc': 46.13472222, u'iso_a2': u'CA', u'max_permi': 34.0, u'feature_co': u'', u'feature_cl': u'', u'rank_max': 7, u'geonameid': -1.0, u'diffascii': 0, u'max_pop10': 37538, u'min_bbymin': 46.09166667, u'pop_max': 37538, u'min_bbymax': 46.18333333, u'capalt': 0.0, u'mean_bbxc': -60.19722222, u'checkme': 0, u'megacity': 0, u'capin': u'', u'pop_min': 37538, u'pop2020': 0.0, u'longitude': -60.1799807145, u'pop2025': 0.0, u'min_bbxmax': -60.13333333, u'adm1name': u'Nova Scotia', u'pop1950': 0.0, u'pop1955': 0.0, u'max_pop310': 0, u'compare': 0, u'max_perkm': 55.0, u'admin1_cod': 0.0, u'adm0_a3': u'CAN', u'timezone': u'', u'note': u'', u'pop2050': 0.0, u'worldcity': 0.0, u'un_long': 0.0, u'max_pop300': 0, u'max_bbxmin': -60.25, u'featurecla': u'Populated place', u'pop1975': 0.0, u'gn_ascii': u'', u'pop1970': 0.0, u'max_bbxmax': -60.13333333, u'un_fid': 0, u'pop_other': 2669348, u'gn_pop': 0}),dsl.way(7, wkt_loads('POINT (-122.4171687735523 37.76919562968742)'), {u'labelrank': 1, u'max_bbymin': 37.575, u'max_bbymax': 38.04166667, u'namediff': 0, u'max_areami': 675.0, u'pop1960': 2200.0, u'pop1965': 2361.0, u'min_perkm': 126.0, u'max_pop50': 1371285, u'source': u'naturalearthdata.com', u'latitude': 37.7400077505, u'elevation': 16.0, u'diffnote': u'', u'min_areakm': 218, u'namealt': u'San Francisco-Oakland', u'rank_min': 11, u'sov0name': u'United States', u'cityalt': u'San Francisco', u'name': u'San Francisco', u'pop1995': 3095.0, u'max_natsca': 300, u'pop1990': 2961.0, u'max_pop20': 1130999, u'min_bbxmin': -122.51666667, u'adm0cap': 0.0, u'max_areakm': 1748.0, u'natscale': 300, u'pop2010': 3450.0, u'pop2015': 3544.0, u'pop1985': 2805.0, u'pop1980': 2656.0, u'sov_a3': u'USA', u'un_adm0': u'United States of America', u'ls_match': 1, u'namepar': u'', u'min_areami': 84.0, u'adm0name': u'United States of America', u'un_lat': 37.79, u'min_permi': 78.0, u'pop2000': 3236.0, u'pop2005': 3387.0, u'changed': 0.0, u'nameascii': u'San Francisco', u'geonamesno': u'GeoNames match with ascii name + lat + long whole numbers.', u'meganame': u'San Francisco-Oakland', u'scalerank': 1, u'ls_name': u'San Francisco1', u'gtopo30': 60.0, u'mean_bbyc': 37.62228831, u'iso_a2': u'US', u'max_permi': 469.0, u'feature_co': u'PPL', u'feature_cl': u'P', u'rank_max': 12, u'geonameid': 5391959.0, u'diffascii': 0, u'max_pop10': 988636, u'min_bbymin': 37.19166667, u'pop_max': 3450000, u'min_bbymax': 37.81666667, u'capalt': 0.0, u'mean_bbxc': -122.301354098, u'checkme': 0, u'megacity': 1, u'capin': u'', u'pop_min': 732072, u'pop2020': 3684.0, u'longitude': -122.459977663, u'pop2025': 3803.0, u'min_bbxmax': -122.35833333, u'adm1name': u'California', u'pop1950': 1855.0, u'pop1955': 2021.0, u'max_pop310': 4561697, u'compare': 0, u'max_perkm': 755.0, u'admin1_cod': 0.0, u'adm0_a3': u'USA', u'timezone': u'America/Los_Angeles', u'note': u'', u'pop2050': 3898.0, u'worldcity': 1.0, u'un_long': -122.38, u'max_pop300': 4561697, u'max_bbxmin': -122.51666667, u'featurecla': u'Populated place', u'pop1975': 2590.0, u'gn_ascii': u'San Francisco', u'pop1970': 2529.0, u'max_bbxmax': -121.73333333, u'un_fid': 570, u'pop_other': 27400, u'gn_pop': 732072}),dsl.way(8, wkt_loads('POINT (126.997785138202 37.56829495838893)'), {u'labelrank': 3, u'max_bbymin': 37.41202199, u'max_bbymax': 37.875, u'namediff': 0, u'max_areami': 1049.0, u'pop1960': 2361.0, u'pop1965': 3452.0, u'min_perkm': 546.0, u'max_pop50': 21387676, u'source': u'naturalearthdata.com', u'latitude': 37.5663490998, u'elevation': 0.0, u'diffnote': u'', u'min_areakm': 971, u'namealt': u'', u'rank_min': 13, u'sov0name': u'Korea, South', u'cityalt': u'', u'name': u'Seoul', u'pop1995': 10256.0, u'max_natsca': 300, u'pop1990': 10544.0, u'max_pop20': 13143622, u'min_bbxmin': 126.55, u'adm0cap': 1.0, u'max_areakm': 2718.0, u'natscale': 300, u'pop2010': 9796.0, u'pop2015': 9762.0, u'pop1985': 9547.0, u'pop1980': 8258.0, u'sov_a3': u'KOR', u'un_adm0': u'Republic of Korea', u'ls_match': 1, u'namepar': u'', u'min_areami': 375.0, u'adm0name': u'South Korea', u'un_lat': 37.54, u'min_permi': 340.0, u'pop2000': 9917.0, u'pop2005': 9825.0, u'changed': 0.0, u'nameascii': u'Seoul', u'geonamesno': u'GeoNames match general.', u'meganame': u'Seoul', u'scalerank': 1, u'ls_name': u'Seoul', u'gtopo30': 46.0, u'mean_bbyc': 37.485925482, u'iso_a2': u'KR', u'max_permi': 1181.0, u'feature_co': u'PPLC', u'feature_cl': u'P', u'rank_max': 13, u'geonameid': 1835848.0, u'diffascii': 0, u'max_pop10': 12322855, u'min_bbymin': 36.75, u'pop_max': 9796000, u'min_bbymax': 37.79166667, u'capalt': 0.0, u'mean_bbxc': 126.971294558, u'checkme': 0, u'megacity': 1, u'capin': u'', u'pop_min': 9796000, u'pop2020': 9740.0, u'longitude': 126.999730997, u'pop2025': 9738.0, u'min_bbxmax': 127.26666667, u'adm1name': u'Seoul', u'pop1950': 1021.0, u'pop1955': 1553.0, u'max_pop310': 21991959, u'compare': 0, u'max_perkm': 1901.0, u'admin1_cod': 11.0, u'adm0_a3': u'KOR', u'timezone': u'Asia/Seoul', u'note': u'', u'pop2050': 9738.0, u'worldcity': 1.0, u'un_long': 126.93, u'max_pop300': 21991959, u'max_bbxmin': 126.76718461, u'featurecla': u'Admin-0 capital', u'pop1975': 6808.0, u'gn_ascii': u'Seoul', u'pop1970': 5312.0, u'max_bbxmax': 127.325, u'un_fid': 336, u'pop_other': 12018058, u'gn_pop': 10349312}),dsl.way(9, wkt_loads('POINT (135.4581989565952 34.75198107491416)'), {u'labelrank': 2, u'max_bbymin': 34.40833333, u'max_bbymax': 35.1, u'namediff': 0, u'max_areami': 1105.0, u'pop1960': 6227.0, u'pop1965': 7654.0, u'min_perkm': 546.0, u'max_pop50': 13292739, u'source': u'naturalearthdata.com', u'latitude': 34.7500352163, u'elevation': 0.0, u'diffnote': u'Changed feature to Admin-0 region capital.', u'min_areakm': 1561, u'namealt': u'Osaka-Kobe', u'rank_min': 12, u'sov0name': u'Japan', u'cityalt': u'Osaka', u'name': u'Osaka', u'pop1995': 11052.0, u'max_natsca': 300, u'pop1990': 11035.0, u'max_pop20': 10259448, u'min_bbxmin': 134.50833333, u'adm0cap': 0.0, u'max_areakm': 2861.0, u'natscale': 300, u'pop2010': 11294.0, u'pop2015': 11337.0, u'pop1985': 10350.0, u'pop1980': 9990.0, u'sov_a3': u'JPN', u'un_adm0': u'Japan', u'ls_match': 1, u'namepar': u'', u'min_areami': 603.0, u'adm0name': u'Japan', u'un_lat': 34.63, u'min_permi': 339.0, u'pop2000': 11165.0, u'pop2005': 11258.0, u'changed': 4.0, u'nameascii': u'Osaka', u'geonamesno': u'GeoNames rough area, rough name.', u'meganame': u'Osaka-Kobe', u'scalerank': 1, u'ls_name': u'Osaka', u'gtopo30': 4.0, u'mean_bbyc': 34.676718762, u'iso_a2': u'JP', u'max_permi': 747.0, u'feature_co': u'PPLA', u'feature_cl': u'P', u'rank_max': 14, u'geonameid': 1853909.0, u'diffascii': 0, u'max_pop10': 10169723, u'min_bbymin': 34.325, u'pop_max': 11294000, u'min_bbymax': 34.91666667, u'capalt': 0.0, u'mean_bbxc': 135.475415456, u'checkme': 5, u'megacity': 1, u'capin': u'', u'pop_min': 2592413, u'pop2020': 11365.0, u'longitude': 135.460144815, u'pop2025': 11368.0, u'min_bbxmax': 135.88333333, u'adm1name': u'Osaka', u'pop1950': 4147.0, u'pop1955': 5120.0, u'max_pop310': 15645640, u'compare': 0, u'max_perkm': 1202.0, u'admin1_cod': 32.0, u'adm0_a3': u'JPN', u'timezone': u'Asia/Tokyo', u'note': u'', u'pop2050': 11368.0, u'worldcity': 1.0, u'un_long': 135.51, u'max_pop300': 15645640, u'max_bbxmin': 135.30459799, u'featurecla': u'Admin-1 region capital', u'pop1975': 9844.0, u'gn_ascii': u'Osaka', u'pop1970': 9408.0, u'max_bbxmax': 135.88333333, u'un_fid': 315, u'pop_other': 9630783, u'gn_pop': 2592413}),dsl.way(10, wkt_loads('POINT (151.1832339501475 -33.91806510862875)'), {u'labelrank': 3, u'max_bbymin': -34.09166667, u'max_bbymax': -33.6, u'namediff': 0, u'max_areami': 544.0, u'pop1960': 2135.0, u'pop1965': 2390.0, u'min_perkm': 468.0, u'max_pop50': 3164008, u'source': u'naturalearthdata.com', u'latitude': -33.9200109672, u'elevation': 0.0, u'diffnote': u'Changed feature class.', u'min_areakm': 1078, u'namealt': u'', u'rank_min': 12, u'sov0name': u'Australia', u'cityalt': u'', u'name': u'Sydney', u'pop1995': 3839.0, u'max_natsca': 300, u'pop1990': 3632.0, u'max_pop20': 2731457, u'min_bbxmin': 150.53333333, u'adm0cap': 0.0, u'max_areakm': 1409.0, u'natscale': 600, u'pop2010': 4327.0, u'pop2015': 4427.0, u'pop1985': 3432.0, u'pop1980': 3227.0, u'sov_a3': u'AUS', u'un_adm0': u'Australia', u'ls_match': 1, u'namepar': u'', u'min_areami': 416.0, u'adm0name': u'Australia', u'un_lat': -33.88, u'min_permi': 291.0, u'pop2000': 4078.0, u'pop2005': 4260.0, u'changed': 4.0, u'nameascii': u'Sydney', u'geonamesno': u'GeoNames rough area, rough name, requires further research.', u'meganame': u'Sydney', u'scalerank': 0, u'ls_name': u'Sydney1', u'gtopo30': 0.0, u'mean_bbyc': -33.846723594, u'iso_a2': u'AU', u'max_permi': 445.0, u'feature_co': u'', u'feature_cl': u'', u'rank_max': 12, u'geonameid': 2147714.0, u'diffascii': 0, u'max_pop10': 2731457, u'min_bbymin': -34.09166667, u'pop_max': 4630000, u'min_bbymax': -33.64166667, u'capalt': 0.0, u'mean_bbxc': 151.051024066, u'checkme': 0, u'megacity': 1, u'capin': u'', u'pop_min': 3641422, u'pop2020': 4582.0, u'longitude': 151.185179809, u'pop2025': 4716.0, u'min_bbxmax': 151.30833333, u'adm1name': u'New South Wales', u'pop1950': 1690.0, u'pop1955': 1906.0, u'max_pop310': 3164008, u'compare': 0, u'max_perkm': 717.0, u'admin1_cod': 0.0, u'adm0_a3': u'AUS', u'timezone': u'', u'note': u'', u'pop2050': 4826.0, u'worldcity': 1.0, u'un_long': 151.02, u'max_pop300': 3164008, u'max_bbxmin': 150.83196335, u'featurecla': u'Admin-1 capital', u'pop1975': 2960.0, u'gn_ascii': u'', u'pop1970': 2667.0, u'max_bbxmax': 151.34166667, u'un_fid': 276, u'pop_other': 2669348, u'gn_pop': 4394576}),dsl.way(11, wkt_loads('POINT (114.1830634584631 22.30692675357551)'), {u'labelrank': 0, u'max_bbymin': 22.2, u'max_bbymax': 24.03333333, u'namediff': 0, u'max_areami': 4116.0, u'pop1960': 2620.0, u'pop1965': 3191.0, u'min_perkm': 219.0, u'max_pop50': 16718429, u'source': u'naturalearthdata.com', u'latitude': 22.304980895, u'elevation': 0.0, u'diffnote': u'', u'min_areakm': 202, u'namealt': u'', u'rank_min': 12, u'sov0name': u'China', u'cityalt': u'', u'name': u'Hong Kong', u'pop1995': 6206.0, u'max_natsca': 300, u'pop1990': 5677.0, u'max_pop20': 15779579, u'min_bbxmin': 112.53333333, u'adm0cap': 0.0, u'max_areakm': 10661.0, u'natscale': 600, u'pop2010': 7206.0, u'pop2015': 7419.0, u'pop1985': 5070.0, u'pop1980': 4609.0, u'sov_a3': u'CHN', u'un_adm0': u'China, Hong Kong Special Administrative Region', u'ls_match': 1, u'namepar': u'', u'min_areami': 78.0, u'adm0name': u'Hong Kong S.A.R.', u'un_lat': 22.27, u'min_permi': 136.0, u'pop2000': 6662.0, u'pop2005': 7057.0, u'changed': 0.0, u'nameascii': u'Hong Kong', u'geonamesno': u'GeoNames match general.', u'meganame': u'Hong Kong', u'scalerank': 0, u'ls_name': u'Hong Kong', u'gtopo30': -9999.0, u'mean_bbyc': 22.679604942, u'iso_a2': u'HK', u'max_permi': 4656.0, u'feature_co': u'PPLC', u'feature_cl': u'P', u'rank_max': 13, u'geonameid': 1819729.0, u'diffascii': 0, u'max_pop10': 4551579, u'min_bbymin': 21.925, u'pop_max': 7206000, u'min_bbymax': 22.4, u'capalt': 0.0, u'mean_bbxc': 114.035195374, u'checkme': 0, u'megacity': 1, u'capin': u'', u'pop_min': 4551579, u'pop2020': 7744.0, u'longitude': 114.185009317, u'pop2025': 8040.0, u'min_bbxmax': 114.3, u'adm1name': u'', u'pop1950': 1682.0, u'pop1955': 2121.0, u'max_pop310': 42594594, u'compare': 0, u'max_perkm': 7493.0, u'admin1_cod': 0.0, u'adm0_a3': u'HKG', u'timezone': u'Asia/Hong_Kong', u'note': u'', u'pop2050': 8305.0, u'worldcity': 1.0, u'un_long': 114.17, u'max_pop300': 16718429, u'max_bbxmin': 113.98333333, u'featurecla': u'Admin-0 region capital', u'pop1975': 3943.0, u'gn_ascii': u'Hong Kong', u'pop1970': 3458.0, u'max_bbxmax': 114.775, u'un_fid': 210, u'pop_other': 4549026, u'gn_pop': 7012738}))

    def test_historic_place(self):
        # ne historic place
        self.assert_has_feature(
            16, 38247, 21826, 'places',
            {'id': int, 'name': 'Chernobyl',
             'kind': 'locality', 'kind_detail': 'hamlet'})

    def test_scientific_station(self):
        # ne scientific station
        self.assert_has_feature(
            16, 22209, 47255, 'places',
            {'id': int, 'name': 'Elephant Island',
             'kind': 'locality', 'kind_detail': 'scientific_station'})

    def test_country_capital(self):
        # ne capitals
        self.assert_has_feature(
            7, 109, 49, 'places',
            {'id': int, 'name': 'Seoul',
             'kind': 'locality', 'country_capital': True})

        self.assert_has_feature(
            7, 112, 50, 'places',
            {'id': int, 'name': 'Kyoto',
             'kind': 'locality', 'country_capital': True})

        self.assert_has_feature(
            7, 104, 55, 'places',
            {'id': int, 'name': 'Hong Kong',
             'kind': 'locality', 'country_capital': True})

    def test_region_capital(self):
        # ne state_capitals
        self.assert_has_feature(
            7, 117, 76, 'places',
            {'id': int, 'name': 'Sydney',
             'kind': 'locality', 'region_capital': True})

        self.assert_has_feature(
            7, 112, 50, 'places',
            {'id': int, 'name': 'Osaka',
             'kind': 'locality', 'region_capital': True})

    def test_populated_place_not_capital(self):
        # ne populated place
        self.assert_has_feature(
            7, 20, 49, 'places',
            {'id': int, 'name': 'San Francisco',
             'kind': 'locality', 'region_capital': type(None),
             'country_capital': type(None)})
